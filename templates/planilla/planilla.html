{% extends "base.html" %}
{% block title %}Planilla {{ periodo }}{% endblock %}

{% block content %}
<div class="card shadow-sm">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2 class="m-0">Planilla {{ periodo.anio }}-{{ periodo.mes|add:"0"|slice:":2" }}</h2>
      <div class="d-flex gap-2">
        <form method="post" action="{% url 'planilla_periodo' periodo.anio periodo.mes %}">
          {% csrf_token %}
          <button class="btn btn-outline-primary" type="submit"> Generar / Recalcular</button>
        </form>
        <a href="{% url 'planilla_excel' periodo.anio periodo.mes %}" class="btn btn-outline-secondary">Excel</a>
        <a href="{% url 'planilla_pdf' periodo.anio periodo.mes %}" class="btn btn-outline-secondary">PDF</a>
      </div>
    </div>

    <div class="mb-3">
      <small class="text-muted">
        Parámetros: ISSS empleado {{ cfg.isss_empleado_pct }}% (techo {{ cfg.isss_techo }}), AFP empleado {{ cfg.afp_empleado_pct }}%.
        <!-- Si quieres mostrar los tramos de renta, podemos listarlos aquí -->
      </small>
    </div>

    <div class="table-responsive">
      <table class="table table-sm table-hover">
        <thead class="table-light">
          <tr>
            <th>Empleado</th>
            <th class="text-end">Salario</th>
            <th class="text-end">ISSS</th>
            <th class="text-end">AFP</th>
            <th class="text-end">Renta</th>
            <th class="text-end">Líquido</th>
          </tr>
        </thead>
        <tbody>
          {% for l in lineas %}
            <tr>
              <td>{{ l.empleado.nombre }}</td>
              <td class="text-end">${{ l.salario_base|floatformat:2 }}</td>
              <td class="text-end">${{ l.isss|floatformat:2 }}</td>
              <td class="text-end">${{ l.afp|floatformat:2 }}</td>
              <td class="text-end">${{ l.renta|floatformat:2 }}</td>
              <td class="text-end fw-semibold">${{ l.liquido|floatformat:2 }}</td>
            </tr>
          {% empty %}
            <tr><td colspan="6" class="text-center text-muted">No hay líneas.</td></tr>
          {% endfor %}
        </tbody>
        <tfoot class="table-light">
          <tr>
            <th colspan="5" class="text-end">Total líquido:</th>
            <th class="text-end">${{ total_liquido|floatformat:2 }}</th>
          </tr>
        </tfoot>
      </table>
    </div>

  </div>
</div>
{% endblock %}
